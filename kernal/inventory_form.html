{% extends "product.php.html" %}

{% block left_link %}
    {% for name,link in main_link.items %}
            <div class='span-6 last'><a href='{{link}}'>{{name|upper}}</a></div>
    {% endfor%}
{% endblock %}

{% block content %}
<link rel="stylesheet" rev="stylesheet" href="https://demo.phppointofsale.com/css/phppos.css" /> 
<link rel="stylesheet" rev="stylesheet" href="https://demo.phppointofsale.com/css/phppos_print.css"  media="print"/> 
<style type="text/css">
#stockCount{
    font-weight: bold;
}


#register_wrapper div{
    text-align: center;
}
    
table{
    padding: 1em;
    
}

th{
    text-align:center;
}
tfoot td{
    text-align:right;
    font-weight:bold;
}

td{
    text-align: left;
}

.totalPrice{
   text-align: right;
}

td input[type="text"] {

    text-align:center;
    padding: 0;
    margin:0;
}

#supplierDetail{
border : solid red 1px;
display: inline;
float: left;
}

#supplierDetail table{
  border: double black 1px;
  width: 45%;
  margin: 0 0 0 1em;
  background-color: #C3D9FF;  
}

#supplierDetail table tr td{
  border: none;
}

#inventoryDetail {
clear: both;
}
#inventoryBatch{
  width: 40%;
  float: left;
}

#inventoryBatch table{
  border: double black 1px;
  width: 95%;
  margin: 0 0 0 1em;
  background-color: #C3D9FF;  
}

#inventoryBatch table tr td{
  border: none;
}

#register{
    visibility: hidden;
}
  
</style>


    <div id="content_area_wrapper">
        <div id="content_area">
            <div id="page_title" style="margin-bottom:8px;">
                Receiving
            </div>


<form action="/inventory/confirm" method="get">
            <div id="inventoryBatch">
                <table>
                    <th colspan=2 style="border-bottom: black 1.5px solid;"> Receivings Record</th>
                    {{form}}             
                    <tr><th></th><td><input type="submit" value="Fulfill Detail" onClick="expandDetail();return false;	" /><td></tr>
                </table>
            </div>
            <div id="inventoryBatch">
                <table>
                    <th colspan=2 style="border-bottom: black 1.5px solid;"> Supplier Detail</th>
                    {{form}}             
                    <tr><th></th><td><input type="submit" value="Fulfill Detail" onClick="expandDetail();return false;	" /><td></tr>
                </table>
            </div>			
            <div id="inventoryDetail">
                <div>
                    <table id="register">
                        <thead>
                            <tr>
                                <th colspan=6 style="text-align:left;border-bottom:solid 1px black">
                                    <div>
                                        <span  style="width:10%;margin: 0 100px 0 0"><label id="item_label" for="item">Item barcode</label> <input type="text" name="item" value="" id="item" size="40"  class="ac_input" onclick="return false;"/></span>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th style="width:20%;">Item #</th>

                                <th style="width:31%;">Item Name</th>

                                <th style="width:12%;">Cost</th>

                                <th style="width:12%;">Qty.</th>

                                <th style="width:15%;">Inventory</th>
                                
                                <th style="width:10%;">Serials no.</th>                                
                            </tr>
                        </thead>

                        <tbody id="sell_detail">
                        </tbody>
                        <tfoot>
                        <tr><td colspan=6><input type=submit value="Confirm"></td></tr>
                        </tfoot>
                    </table>                
                    
                </div>
            </div>
</form>                                        


                <div class="clearfix">
                    &nbsp;
                </div>

                <div class="clearfix" style="margin-bottom:1px;">
                    &nbsp;
                </div>
            </div>

            <div class="clearfix" style="margin-bottom:30px;">
                &nbsp;
            </div>
        </div>
    </div>
    
  
  <script type="text/javascript">
    var productTable = new Array();
    var quantityTable = new Array();
    $("#item").keydown(function(event){
        if(event.keyCode != '13'){
            return;
        }
        if ( productTable[$("#item").val()] == undefined){
            row = $('#sell_detail').html();
            /**
                query product infor by ajax
            **/
            $.ajax({
                url: "/product/info/"+$("#item").val(),
                type: "JSON",
                success: function(data){  
                    for (var i = 0; i < data.length; i++){
                        var barcode = data[i].fields.barcode;
                        productTable[barcode] = data;       
                        quantityTable[barcode] = 1;       
                        row += ""+
                                "<tr id=\""+barcode+"_tr\">"+
                                "<td><a href='#' id='removeItem' onclick=removeItem('"+barcode+"')><img src='/static/images/delete.png' /></a> "+barcode+"</td>"+
                                "<td id=\""+barcode+"_productName\">"+data[i].fields.name+"</td>"+
                                "<td>$<input type=\"text\" name=\""+barcode+"_cost\" id=\""+barcode+"_cost\" value=\""+data[i].fields.cost+" \" size=\"6\" /></td>"+
                                "<td style='text-align: center'><input type=\"text\" name=\""+barcode+"_quantity\" id=\""+barcode+"_quantity\" value=\"1\" size=\"2\"  /> </td>"+
                                "<td id=\""+barcode+"_Inventory\" class='Inventory'>0</td>"+
                                "<td id=\""+barcode+"_serialno\" class='SerialNo'><a href='#'>optional</a></td>"+
                                "</tr>"
                        ;                        
                    }

                    $('#sell_detail').html(row);
                    
                    for (var key in productTable){
                        $("#"+key+"_quantity").attr("value", quantityTable[key]);
                    }
                    
                },
                error: function(data){ alert("Product Not found! please check your barcode: " + $("#item").val()) },
                complete: function(data){ 
                    calcSubTotalPrice();
                },
            });            
            /**
                query product inventory by ajax
            **/
            $.ajax({
                url: "/product/inventory/"+$("#item").val(),
                type: "JSON",
                success: function(data){  
                    $("#"+$("#item").val()+"_Inventory").html(data[0].inventory);
                },
                error: function(data){ alert("Product Not found! please check your barcode: " + $("#item").val()) },
                complete: function(data){},
            });            
            
        }else{
            var barcode = $("#item").val();
            quantityPlusOne(barcode)
        }

        return false;
    });
    
    function quantityPlusOne(barcode){
            var quantityField = $("#"+barcode+"_quantity");
            var currentQuantity = parseInt(quantityField.val());
            quantityField.attr("value", currentQuantity+1);
            quantityTable[barcode] = currentQuantity+1;
    }

    function removeItem(barcode){
        delete productTable[barcode];
        delete quantityTable[barcode];
        $("#"+barcode+"_tr").remove();
    }
    
    
  $("#id_do_date").datepicker({dateFormat: 'yy-mm-dd'});

  $("#item").autocomplete("/product/ajax/", {
		width: 260,
		selectFirst: false
	});
    
  $("#id_supplier").autocomplete("/supplier/ajax/", {
		width: 260,
		selectFirst: false
	});
  
	function expandDetail(){
		
		if($('#id_supplier').val()==''){
			return false;
		}
		if($('#id_do_date').val()==''){
			return false;
		}
		if($('#id_do_no').val()==''){
			return false;
		}
		if($('#id_inv_no').val()==''){
			return false;
		}		
		$('#register').attr('style','visibility: visible;'); 
	}
  
  
  </script>
  
{% endblock %}



