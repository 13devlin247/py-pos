{% extends "product.php.html" %}

{% block left_link %}
    {% for name,link in main_link.items %}
            <div class='span-6 last'><a href='{{link}}'>{{name|upper}}</a></div>
    {% endfor%}
{% endblock %}

{% block content %}
<style type="text/css">
#stockCount{
    font-weight: bold;
}


#register_wrapper div{
    text-align: center;
}
    
table{
    padding: 1em;
    
}

th{
    text-align:center;
}
tfoot td{
    text-align:right;
    font-weight:bold;
}

td{
    text-align: left;
}

.totalPrice{
   text-align: right;
}

td input[type="text"] {

    text-align:center;
    padding: 0;
    margin:0;
}
#inventoryDetail {
  border: solid red 1px;
  
}
#inventoryBatch span{
  display: block;
}

</style>


    <div id="content_area_wrapper">
        <div id="content_area">
            <div id="page_title" style="margin-bottom:8px;">
                Sales Register
            </div>
<div>
<span  style="width:10%;margin: 0 100px 0 0"><label id="item_label" for="item">Item barcode</label> <input type="text" name="item" value="BR00545650001" id="item" size="40" autocomplete="off" class="ac_input" onclick=false/></span>
</div>


<form action="/inventory/confirm" method="get">
            <div id="inventoryDetail">
                <div>
                    <table id="register">
                        <thead>
                            <tr>
                                <th colspan=6 style="border-bottom: 1px gray solid;text-align: left;" id="inventoryBatch">
                                  <span style="text-align:right"><label id="po_no" for="customer">Supplier: </label> <input type="text" name="po_no" value="" id="po_no" size="30" autocomplete="off" class="ac_input" /> </span>
                                  <span style="text-align:right"><label id="po_no" for="customer">DO no: </label> <input type="text" name="po_no" value="" id="po_no" size="30" autocomplete="off" class="ac_input" /> </span>
                                  <span style="text-align:right"><label id="po_no" for="customer">Invoice no: </label> <input type="text" name="po_no" value="" id="po_no" size="30" autocomplete="off" class="ac_input" /> </span>
                                </th>
                            </tr>
                            <tr>
                                <th style="width:20%;">Item #</th>

                                <th style="width:31%;">Item Name</th>

                                <th style="width:12%;">Cost</th>

                                <th style="width:12%;">Qty.</th>

                                <th style="width:15%;">Inventory</th>
                                
                                <th style="width:10%;">Serials no.</th>                                
                            </tr>
                        </thead>

                        <tbody id="sell_detail">
                        </tbody>
                    </table>                
                    <input type=submit value="Confirm">
                </div>
            </div>
</form>                                        


                <div class="clearfix">
                    &nbsp;
                </div>

                <div class="clearfix" style="margin-bottom:1px;">
                    &nbsp;
                </div>
            </div>

            <div class="clearfix" style="margin-bottom:30px;">
                &nbsp;
            </div>
        </div>
    </div>
    
  
  <script type="text/javascript">
    var productTable = new Array();
    var quantityTable = new Array();
    $("#item").keydown(function(event){
        if(event.keyCode != '13'){
            return;
        }
        if ( productTable[$("#item").val()] == undefined){
            row = $('#sell_detail').html();
            /**
                query product infor by ajax
            **/
            $.ajax({
                url: "/product/info/"+$("#item").val(),
                type: "JSON",
                success: function(data){  
                    for (var i = 0; i < data.length; i++){
                        var barcode = data[i].fields.barcode;
                        productTable[barcode] = data;       
                        quantityTable[barcode] = 1;       
                        row += ""+
                                "<tr id=\""+barcode+"_tr\">"+
                                "<td><a href='#' id='removeItem' onclick=removeItem('"+barcode+"')><img src='/static/images/delete.png' /></a> "+barcode+"</td>"+
                                "<td id=\""+barcode+"_productName\">"+data[i].fields.name+"</td>"+
                                "<td>$<input type=\"text\" name=\""+barcode+"_cost\" id=\""+barcode+"_cost\" value=\""+data[i].fields.price+" \" size=\"6\" /></td>"+
                                "<td style='text-align: center'><input type=\"text\" name=\""+barcode+"_quantity\" id=\""+barcode+"_quantity\" value=\"1\" size=\"2\"  /> </td>"+
                                "<td id=\""+barcode+"_Inventory\" class='Inventory'>0</td>"+
                                "<td id=\""+barcode+"_serialno\" class='SerialNo'><a href='#'>optional</a></td>"+
                                "</tr>"
                        ;                        
                    }

                    $('#sell_detail').html(row);
                    
                    for (var key in productTable){
                        $("#"+key+"_quantity").attr("value", quantityTable[key]);
                    }
                    
                },
                error: function(data){ alert("Product Not found! please check your barcode: " + $("#item").val()) },
                complete: function(data){ 
                    calcSubTotalPrice();
                },
            });            
            /**
                query product inventory by ajax
            **/
            $.ajax({
                url: "/product/inventory/"+$("#item").val(),
                type: "JSON",
                success: function(data){  
                    $("#"+$("#item").val()+"_Inventory").html(data[0].inventory);
                },
                error: function(data){ alert("Product Not found! please check your barcode: " + $("#item").val()) },
                complete: function(data){},
            });            
            
        }else{
            var barcode = $("#item").val();
            quantityPlusOne(barcode)
        }


    });
    
    function quantityPlusOne(barcode){
            var quantityField = $("#"+barcode+"_quantity");
            var currentQuantity = parseInt(quantityField.val());
            quantityField.attr("value", currentQuantity+1);
            quantityTable[barcode] = currentQuantity+1;
    }

    function removeItem(barcode){
        delete productTable[barcode];
        delete quantityTable[barcode];
        $("#"+barcode+"_tr").remove();
    }
    
    
  </script>
  
{% endblock %}



